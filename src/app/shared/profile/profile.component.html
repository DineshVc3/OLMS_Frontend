
<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="profileModalLabel">
          <i class="fa fa-user-circle me-2"></i>My Profile
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeModal()" aria-label="Close"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <ng-container *ngTemplateOutlet="profileContent"></ng-container>
      </div>

      <!-- Footer -->
      <div class="modal-footer" *ngIf="user && !isLoading">
        <ng-container *ngTemplateOutlet="actionButtons"></ng-container>
      </div>
    </div>
  </div>
</div>

<!-- Profile Content Template -->
<ng-template #profileContent>
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 text-muted">Updating profile...</p>
  </div>

  <!-- Message -->
  <div *ngIf="message" class="alert alert-dismissible fade show" 
       [class.alert-success]="messageType === 'success'" 
       [class.alert-danger]="messageType === 'error'">
    <i class="fa me-2" 
       [class.fa-check-circle]="messageType === 'success'" 
       [class.fa-exclamation-triangle]="messageType === 'error'"></i>
    {{ message }}
    <button type="button" class="btn-close" (click)="clearMessage()"></button>
  </div>

  <!-- Profile Display -->
  <div *ngIf="user && !isLoading">
    <div *ngIf="!isEditing">
      <ng-container *ngTemplateOutlet="profileView"></ng-container>

    </div>
    <div *ngIf="isEditing">
      <ng-container *ngTemplateOutlet="profileEdit"></ng-container>
      <div class="mt-3">
        <ng-container *ngTemplateOutlet="editButtons"></ng-container>
      </div>
    </div>
  </div>

  <!-- No User -->
  <div *ngIf="!user && !isLoading" class="text-center py-4">
    <i class="fa fa-user-times text-danger" style="font-size: 3rem;"></i>
    <h6 class="mt-3">No Profile Data</h6>
    <p class="text-muted">Unable to load your profile information. Please try logging in again.</p>
  </div>
</ng-template>

<!-- Profile View Template -->
<ng-template #profileView>
  <h6 class="text-primary border-bottom pb-2 mb-3">Personal Information</h6>
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <label class="form-label text-muted small">Full Name</label>
      <p class="fw-semibold">{{ user?.name || 'Not provided' }}</p>
    </div>
    <div class="col-md-6">
      <label class="form-label text-muted small">Email Address</label>
      <p class="fw-semibold">{{ user?.email }}</p>
    </div>
    <div class="col-md-6">
      <label class="form-label text-muted small">Phone Number</label>
      <p class="fw-semibold">{{ user?.phoneNumber || 'Not provided' }}</p>
    </div>
    <div class="col-md-6">
      <label class="form-label text-muted small">Role</label>
      <p>
        <span class="badge" [class]="'bg-' + getRoleBootstrapColor(user?.role || 0)">
          {{ getRoleDisplayName(user?.role || 0) }}
        </span>
      </p>
    </div>
  </div>

  <h6 class="text-primary border-bottom pb-2 mb-3">Account Details</h6>
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label text-muted small">User ID</label>
      <p class="fw-semibold">#{{ getUserId() || 'N/A' }}</p>
    </div>
    <div class="col-md-6">
      <label class="form-label text-muted small">Account Created</label>
      <p class="fw-semibold">{{ formatDate(user?.createdAt) }}</p>
    </div>
    <div class="col-md-6" *ngIf="user?.modifiedAt">
      <label class="form-label text-muted small">Last Modified</label>
      <p class="fw-semibold">{{ formatDate(user?.modifiedAt) }}</p>
    </div>
  </div>
</ng-template>

<!-- Profile Edit Template -->
<ng-template #profileEdit>
  <form (ngSubmit)="saveProfile()">
    <h6 class="text-primary border-bottom pb-2 mb-3">Edit Personal Information</h6>
    <div class="row g-3">
      <div class="col-md-6">
        <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="name" 
               [(ngModel)]="editForm.name" name="name" required
               placeholder="Enter your full name">
      </div>
      <div class="col-md-6">
        <label for="email" class="form-label">Email Address</label>
        <input type="email" class="form-control" id="email" 
               [value]="editForm.email" readonly
               title="Email cannot be changed">
        <div class="form-text">Email address cannot be modified</div>
      </div>
      <div class="col-md-6">
        <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
        <input type="tel" class="form-control" id="phone"
               [(ngModel)]="editForm.phoneNumber" name="phone" required
               placeholder="Enter your phone number">
      </div>
      <div class="col-md-6">
        <label class="form-label">Role</label>
        <div class="p-2 bg-light rounded">
          <span class="badge" [class]="'bg-' + getRoleBootstrapColor(user?.role || 0)">
            {{ getRoleDisplayName(user?.role || 0) }}
          </span>
          <div class="form-text">Role cannot be modified</div>
        </div>
      </div>
    </div>
  </form>
</ng-template>

<!-- Action Buttons -->
<ng-template #actionButtons>
  <button *ngIf="!isEditing" type="button" class="btn btn-primary" (click)="toggleEdit()">
    <i class="fa fa-edit me-2"></i>Edit Profile
  </button>
</ng-template>

<!-- Edit Buttons -->
<ng-template #editButtons>
  <div class="d-flex gap-2 w-100">
    <button type="button" class="btn btn-success" (click)="saveProfile()" 
            [disabled]="!isValidForm() || isLoading">
      <i class="fa fa-save me-2"></i>Save Changes
    </button>
    <button type="button" class="btn btn-secondary" (click)="cancelEdit()" 
            [disabled]="isLoading">
      <i class="fa fa-times me-2"></i>Cancel
    </button>
  </div>
</ng-template>
